<beast version="2.0" namespace="beast.app.beauti:beast.core:beast.evolution.branchratemodel:beast.evolution.speciation:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.likelihood:beast.evolution:beast.math.distributions">


       
    <!-- tree priors -->
    <mergewith point='sb3TreePriorTemplates'>
	
	
	
	
	
        <!-- Birth Collapse -->
        <subtemplate id='BirthCollapse' class='speedemon.CollapseModel' mainid='BirthCollapse.t:$(n)'>
<![CDATA[
            <parameter id="YuleCollapseBirthRate.t:$(n)" spec="parameter.RealParameter" lower="0.0" name="stateNode">1.0</parameter>
            <parameter id="collapseWeightBirthCollapse.t:$(n)" spec="parameter.RealParameter" lower="0.0" name="stateNode" upper="1.0">0.5</parameter>
             
            <distribution id="BirthCollapse.t:$(n)" spec="speedemon.CollapseModel" 
                        epsilon="1.0E-4" 
                        weight="@collapseWeightBirthCollapse.t:$(n)"
                        tree="@Tree.t:$(n)">
						

				<treePrior id="YuleCollapseModel.t:$(n)" spec="beast.evolution.speciation.YuleModel" tree="@Tree.t:$(n)" birthDiffRate="@YuleCollapseBirthRate.t:$(n)" />
						
			</distribution>

            <prior id="YuleCollapseBirthRatePrior.t:$(n)" name="distribution" x="@YuleCollapseBirthRate.t:$(n)">
                    <LogNormal meanInRealSpace="true" name="distr" M="1.0" S="1.25"/>
            </prior>

            <prior id="collapseWeightBirthCollapse.prior.t:$(n)" name="distribution" x="@collapseWeightBirthCollapse.t:$(n)">
                    <Beta name="distr" alpha="1.0" beta="3.0"/>
            </prior>


			<operator id="AdaptableOperatorSampler.YuleCollapseBirthRate.t:$(n)" spec="orc.operators.AdaptableOperatorSampler" weight="3.0">
				<parameter idref="YuleCollapseBirthRate.t:$(n)"/>
				<operator id="Scale.YuleCollapseBirthRate.t:$(n)" spec="BactrianScaleOperator" parameter="@YuleCollapseBirthRate.t:$(n)" weight="1.0"/>
				<operator id="SampleFromPriorOperator.YuleCollapseBirthRate.t:$(n)" spec="orc.operators.SampleFromPriorOperator" parameter="@YuleCollapseBirthRate.t:$(n)" prior2="@YuleCollapseBirthRatePrior.t:$(n)" weight="1.0"/>
			</operator>
			
			<operator id="AdaptableOperatorSampler.collapseWeightBirthCollapse.t:$(n)" spec="orc.operators.AdaptableOperatorSampler" weight="3.0">
				<parameter idref="collapseWeightBirthCollapse.t:$(n)"/>
				<operator id="Scale.collapseWeightBirthCollapse.t:$(n)" spec="BactrianIntervalOperator" parameter="@collapseWeightBirthCollapse.t:$(n)" weight="1.0"/>
				<operator id="SampleFromPriorOperator.collapseWeightBirthCollapse.t:$(n)" spec="orc.operators.SampleFromPriorOperator" parameter="@collapseWeightBirthCollapse.t:$(n)" prior2="@collapseWeightBirthCollapse.prior.t:$(n)" weight="1.0"/>
			</operator>
	
			
			
]]>



            <connect srcID='BirthCollapse.t:$(n)' targetID='prior' inputName='distribution'
                     if='inposterior(BirthCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and Tree.t:$(n)/estimate=true'>Yule
						Birth collapse speciation prior on tree t:$(n)
            </connect>
            <connect srcID='YuleCollapseBirthRate.t:$(n)' targetID='state' inputName='stateNode'
                     if='inposterior(BirthCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and inposterior(YuleCollapseBirthRate.t:$(n)) and YuleCollapseBirthRate.t:$(n)/estimate=true'>
					 Birth collapse speciation process birth rate of t:$(n)
			</connect>
            <connect srcID='collapseWeightBirthCollapse.t:$(n)' targetID='state' inputName='stateNode'
                     if='inposterior(BirthCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and inposterior(collapseWeightBirthCollapse.t:$(n)) and collapseWeightBirthCollapse.t:$(n)/estimate=true'>
					 Birth collapse weight of t:$(n)
			</connect>

            <connect srcID='YuleCollapseBirthRatePrior.t:$(n)' targetID='prior' inputName='distribution'
                     if='inposterior(BirthCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and YuleCollapseBirthRate.t:$(n)/estimate=true'>
						Birth collapse speciation process birth rate of t:$(n)
            </connect>
			
			 <connect srcID='collapseWeightBirthCollapse.prior.t:$(n)' targetID='prior' inputName='distribution'
                     if='inposterior(BirthCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and collapseWeightBirthCollapse.t:$(n)/estimate=true'>
                Birth collapse weight prior of t:$(n)
            </connect>
			
            <connect srcID='AdaptableOperatorSampler.YuleCollapseBirthRate.t:$(n)' targetID='mcmc' inputName='operator'
                     if='inposterior(BirthCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and YuleCollapseBirthRate.t:$(n)/estimate=true'>
                Adaptively operate on speciation rate gamma-rate for Yule Skyline Collapse prior of tree t:$(n)
            </connect>
			<connect srcID='AdaptableOperatorSampler.collapseWeightBirthCollapse.t:$(n)' targetID='mcmc' inputName='operator'
                     if='inposterior(BirthCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and collapseWeightBirthCollapse.t:$(n)/estimate=true'>
                Adaptively operate on collapse weight for Yule Skyline Collapse prior of tree t:$(n)
            </connect>
           

            <connect srcID='BirthCollapse.t:$(n)' targetID='tracelog' inputName='log'
                     if='inposterior(BirthCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and Tree.t:$(n)/estimate=true'/>
            <connect srcID='collapseWeightBirthCollapse.t:$(n)' targetID='tracelog' inputName='log'
                     if='inposterior(BirthCollapse.t:$(n)) and collapseWeightBirthCollapse.t:$(n)/estimate=true'/>
            <connect srcID='YuleCollapseBirthRate.t:$(n)' targetID='tracelog' inputName='log'
                     if='inposterior(BirthCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and YuleCollapseBirthRate.t:$(n)/estimate=true'/>

        </subtemplate>
		
		
		
	
	
        <!-- YuleSkylineCollapse -->
        <subtemplate id='YuleSkylineCollapse' class='speedemon.YuleSkylineCollapse' mainid='YuleSkylineCollapse.t:$(n)'>
<![CDATA[
            <parameter id="YuleSkylineCollapseBirthRateRate.t:$(n)" spec="parameter.RealParameter" lower="0.0" name="stateNode">1.0</parameter>
            <parameter id="collapseWeight.t:$(n)" spec="parameter.RealParameter" lower="0.0" name="stateNode" upper="1.0">0.5</parameter>
             
            <distribution id="YuleSkylineCollapse.t:$(n)" spec="speedemon.YuleSkylineCollapse" 
                        epsilon="1.0E-4" 
                        weight="@collapseWeight.t:$(n)"
                        linkedMean="true"
                        birthRateShape="2"
                        birthRateRate="@YuleSkylineCollapseBirthRateRate.t:$(n)"
                        equalEpochs="true" tree="@Tree.t:$(n)"                       
                        groupCount="4"/>

            <prior id="YuleSkylineCollapseBirthRateRatePrior.t:$(n)" name="distribution" x="@YuleSkylineCollapseBirthRateRate.t:$(n)">
                    <LogNormal meanInRealSpace="true" name="distr" M="1.0" S="1.25"/>
            </prior>

            <prior id="collapseWeight.prior.t:$(n)" name="distribution" x="@collapseWeight.t:$(n)">
                    <Beta name="distr" alpha="1.0" beta="3.0"/>
            </prior>

			
			<operator id="AdaptableOperatorSampler.YuleSkylineCollapseBirthRateRate.t:$(n)" spec="orc.operators.AdaptableOperatorSampler" weight="3.0">
				<parameter idref="YuleSkylineCollapseBirthRateRate.t:$(n)"/>
				<operator id="Scale.BirthDeathCollapseModel.t:$(n)" spec="BactrianScaleOperator" parameter="@YuleSkylineCollapseBirthRateRate.t:$(n)" weight="1.0"/>
				<operator id="SampleFromPriorOperator.BirthDeathCollapseModel.t:$(n)" spec="orc.operators.SampleFromPriorOperator" parameter="@YuleSkylineCollapseBirthRateRate.t:$(n)" prior2="@YuleSkylineCollapseBirthRateRatePrior.t:$(n)" weight="1.0"/>
    	</operator>
			
			<operator id="AdaptableOperatorSampler.collapseWeight.t:$(n)" spec="orc.operators.AdaptableOperatorSampler" weight="3.0">
				<parameter idref="collapseWeight.t:$(n)"/>
				<operator id="Scale.collapseWeight.t:$(n)" spec="BactrianIntervalOperator" parameter="@collapseWeight.t:$(n)" weight="1.0"/>
				<operator id="SampleFromPriorOperator.collapseWeight.t:$(n)" spec="orc.operators.SampleFromPriorOperator" parameter="@collapseWeight.t:$(n)" prior2="@collapseWeight.prior.t:$(n)" weight="1.0"/>
			</operator>
	
			
			
]]>



            <connect srcID='YuleSkylineCollapse.t:$(n)' targetID='prior' inputName='distribution'
                     if='inposterior(YuleSkylineCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and Tree.t:$(n)/estimate=true'>Yule
                Skyline Collapse speciation prior on tree t:$(n)
            </connect>
            <connect srcID='YuleSkylineCollapseBirthRateRate.t:$(n)' targetID='state' inputName='stateNode'
                     if='inposterior(YuleSkylineCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and inposterior(YuleSkylineCollapseBirthRateRate.t:$(n)) and YuleSkylineCollapseBirthRateRate.t:$(n)/estimate=true'/>
            <connect srcID='collapseWeight.t:$(n)' targetID='state' inputName='stateNode'
                     if='inposterior(YuleSkylineCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and inposterior(collapseWeight.t:$(n)) and collapseWeight.t:$(n)/estimate=true'/>

            <connect srcID='YuleSkylineCollapseBirthRateRatePrior.t:$(n)' targetID='prior' inputName='distribution'
                     if='inposterior(YuleSkylineCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and YuleSkylineCollapseBirthRateRate.t:$(n)/estimate=true'>
                Yule Skyline Collapse speciation process birth rate of t:$(n)
            </connect>
			
			 <connect srcID='collapseWeight.prior.t:$(n)' targetID='prior' inputName='distribution'
                     if='inposterior(YuleSkylineCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and collapseWeight.t:$(n)/estimate=true'>
                Yule Skyline Collapse weight prior of t:$(n)
            </connect>
			
            <connect srcID='AdaptableOperatorSampler.YuleSkylineCollapseBirthRateRate.t:$(n)' targetID='mcmc' inputName='operator'
                     if='inposterior(YuleSkylineCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and YuleSkylineCollapseBirthRateRate.t:$(n)/estimate=true'>
                Adaptively operate on speciation rate gamma-rate for Yule Skyline Collapse prior of tree t:$(n)
            </connect>
			<connect srcID='AdaptableOperatorSampler.collapseWeight.t:$(n)' targetID='mcmc' inputName='operator'
                     if='inposterior(YuleSkylineCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and collapseWeight.t:$(n)/estimate=true'>
                Adaptively operate on collapse weight for Yule Skyline Collapse prior of tree t:$(n)
            </connect>
           

            <connect srcID='YuleSkylineCollapse.t:$(n)' targetID='tracelog' inputName='log'
                     if='inposterior(YuleSkylineCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and Tree.t:$(n)/estimate=true'/>
            <connect srcID='collapseWeight.t:$(n)' targetID='tracelog' inputName='log'
                     if='inposterior(YuleSkylineCollapse.t:$(n)) and collapseWeight.t:$(n)/estimate=true'/>
            <connect srcID='YuleSkylineCollapseBirthRateRate.t:$(n)' targetID='tracelog' inputName='log'
                     if='inposterior(YuleSkylineCollapse.t:$(n)) and inposterior(Tree.t:$(n)) and YuleSkylineCollapseBirthRateRate.t:$(n)/estimate=true'/>

        </subtemplate>
		
		
		
		
		



    </mergewith>
</beast>


